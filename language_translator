import tkinter as tk
from tkinter import ttk, messagebox
from deep_translator import GoogleTranslator
import pyperclip
from gtts import gTTS
import os
import json

# File to store user credentials
USER_DATA_FILE = "users.json"

def load_users():
    try:
        with open(USER_DATA_FILE, "r") as file:
            return json.load(file)
    except (FileNotFoundError, json.JSONDecodeError):
        return {}

def save_users(users):
    with open(USER_DATA_FILE, "w") as file:
        json.dump(users, file)

def register():
    username = reg_username_entry.get()
    password = reg_password_entry.get()
    
    if not username or not password:
        messagebox.showerror("Error", "Please enter both username and password")
        return
    
    users = load_users()
    if username in users:
        messagebox.showerror("Error", "Username already exists")
    else:
        users[username] = password
        save_users(users)
        messagebox.showinfo("Success", "Registration successful! Please login.")
        register_window.destroy()

def open_register():
    global register_window, reg_username_entry, reg_password_entry
    register_window = tk.Tk()
    register_window.title("Register")
    register_window.geometry("300x250")
    register_window.configure(bg="lightgray")

    tk.Label(register_window, text="Username:", bg="lightgray", font=("Arial", 10)).pack(pady=5)
    reg_username_entry = tk.Entry(register_window, width=30)
    reg_username_entry.pack(pady=5)

    tk.Label(register_window, text="Password:", bg="lightgray", font=("Arial", 10)).pack(pady=5)
    reg_password_entry = tk.Entry(register_window, width=30, show="*")
    reg_password_entry.pack(pady=5)

    reg_btn = tk.Button(register_window, text="Register", command=register, bg="green", fg="white", font=("Arial", 12, "bold"))
    reg_btn.pack(pady=10)

    exit_btn = tk.Button(register_window, text="Exit", command=register_window.destroy, bg="red", fg="white", font=("Arial", 12, "bold"))
    exit_btn.pack(pady=5)

    register_window.mainloop()

def login():
    username = username_entry.get()
    password = password_entry.get()
    
    users = load_users()
    if username in users and users[username] == password:
        login_window.destroy()
        open_translator()
    else:
        messagebox.showerror("Login Failed", "Invalid username or password")

def open_translator():
    root = tk.Tk()
    root.title("Language Translator")
    root.geometry("600x450")
    root.configure(bg="lightgray")
    
    languages = ["auto"] + GoogleTranslator().get_supported_languages()
   
    tk.Label(root, text="Source Language:", bg="lightgray", font=("Arial", 10)).grid(row=0, column=0, padx=10, pady=5, sticky="w")
    src_lang_combo = ttk.Combobox(root, values=languages, width=20)
    src_lang_combo.grid(row=0, column=1, padx=10, pady=5)
    src_lang_combo.set("english")

    tk.Label(root, text="Target Language:", bg="lightgray", font=("Arial", 10)).grid(row=0, column=2, padx=10, pady=5, sticky="w")
    dest_lang_combo = ttk.Combobox(root, values=languages, width=20)
    dest_lang_combo.grid(row=0, column=3, padx=10, pady=5)
    dest_lang_combo.set("french")
    
    tk.Label(root, text="Enter Text:", bg="lightgray", font=("Arial", 10)).grid(row=1, column=0, padx=10, pady=5, sticky="w")
    text_input = tk.Text(root, height=5, width=60, font=("Arial", 10))
    text_input.grid(row=2, column=0, columnspan=4, padx=10, pady=5)

    text_output = tk.Text(root, height=5, width=60, font=("Arial", 10))
    text_output.grid(row=5, column=0, columnspan=4, padx=10, pady=5)

    def translate_text():
        input_text = text_input.get("1.0", tk.END).strip()
        src_lang = src_lang_combo.get()
        dest_lang = dest_lang_combo.get()

        if not input_text:
            messagebox.showerror("Error", "Please enter text to translate.")
            return
        
        try:
            translated_text = GoogleTranslator(source=src_lang, target=dest_lang).translate(input_text)
            text_output.delete("1.0", tk.END)
            text_output.insert(tk.END, translated_text)
        except Exception as e:
            messagebox.showerror("Translation Error", str(e))

    def speak_text():
        text = text_output.get("1.0", tk.END).strip()
        if not text:
            messagebox.showerror("Error", "No text to speak.")
            return
        
        try:
            tts = gTTS(text, lang=dest_lang_combo.get())
            tts.save("speech.mp3")
            os.system("start speech.mp3")  # Use "start" for Windows, "mpg321 speech.mp3" for Linux/Mac
        except Exception as e:
            messagebox.showerror("TTS Error", str(e))

    def copy_text():
        translated_text = text_output.get("1.0", tk.END).strip()
        if translated_text:
            pyperclip.copy(translated_text)
            messagebox.showinfo("Copied", "Text copied to clipboard.")
        else:
            messagebox.showerror("Error", "No text to copy.")

    translate_btn = tk.Button(root, text="Translate", command=translate_text, bg="blue", fg="white", font=("Arial", 12, "bold"))
    translate_btn.grid(row=3, column=1, columnspan=2, pady=10)
    
    copy_btn = tk.Button(root, text="Copy", command=copy_text, bg="green", fg="white", font=("Arial", 12, "bold"))
    copy_btn.grid(row=6, column=0, pady=10, padx=10)

    speak_btn = tk.Button(root, text="Speak", command=speak_text, bg="purple", fg="white", font=("Arial", 12, "bold"))
    speak_btn.grid(row=6, column=1, pady=10, padx=10)

    exit_btn = tk.Button(root, text="Exit", command=root.destroy, bg="red", fg="white", font=("Arial", 12, "bold"))
    exit_btn.grid(row=6, column=2, pady=10, padx=10)

    root.mainloop()

# Login Page
login_window = tk.Tk()
login_window.title("Login")
login_window.geometry("300x250")
login_window.configure(bg="lightgray")

tk.Label(login_window, text="Username:", bg="lightgray", font=("Arial", 10)).pack(pady=5)
username_entry = tk.Entry(login_window, width=30)
username_entry.pack(pady=5)

tk.Label(login_window, text="Password:", bg="lightgray", font=("Arial", 10)).pack(pady=5)
password_entry = tk.Entry(login_window, width=30, show="*")
password_entry.pack(pady=5)

login_btn = tk.Button(login_window, text="Login", command=login, bg="blue", fg="white", font=("Arial", 12, "bold"))
login_btn.pack(pady=10)

register_btn = tk.Button(login_window, text="Register", command=open_register, bg="green", fg="white", font=("Arial", 12, "bold"))
register_btn.pack(pady=10)

login_window.mainloop()
 
